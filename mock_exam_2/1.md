# Mock Exam 2 - Question 1

## Question 1: Multi-Container Pod with Shared Volume

In the `ckad-multi-containers` namespace, create a `ckad-neighbor-pod` pod that matches the following requirements:

- Pod has an **emptyDir** volume named `my-vol`
- The first container named `main-container`, runs `nginx:1.16` image. This container mounts the `my-vol` volume at `/usr/share/nginx/html` path
- The second container is a co-located container named `neighbor-container`, and runs the `busybox:1.28` image. This container mounts the volume `my-vol` at `/var/log` path
- Every 5 seconds, this container should write the current date along with greeting message "Hi I am from neighbor container" to `index.html` in the `my-vol` volume

### Solution

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: ckad-neighbor-pod
  namespace: ckad-multi-containers
spec:
  volumes:
  - name: my-vol
    emptyDir: {}
  containers:
  - name: main-container
    image: nginx:1.16
    volumeMounts:
    - name: my-vol
      mountPath: /usr/share/nginx/html   # nginx serves from here
  - name: neighbor-container
    image: busybox:1.28
    command: ["/bin/sh", "-c"]
    args:
    - while true; do
        date >> /var/log/index.html;
        echo "Hi I am from neighbor container" >> /var/log/index.html;
        sleep 5;
      done
    volumeMounts:
    - name: my-vol
      mountPath: /var/log                # shared volume, same as nginx
```

### Commands to Apply and Verify

```bash
kubectl apply -f ckad-neighbor-pod.yaml
```

```bash
kubectl exec -n ckad-multi-containers ckad-neighbor-pod -c main-container -- cat /usr/share/nginx/html/index.html
```

## Explanation

### ðŸ”¹ What emptyDir is

- `emptyDir` is one of Kubernetes' volume types
- It provides temporary storage on the node's filesystem
- The directory is created empty when the Pod starts
- The directory is deleted when the Pod is removed from the node

### ðŸ”¹ Why cat /usr/share/nginx/html/index.html shows the logs

#### Shared emptyDir volume

In your Pod spec, both containers mount the same emptyDir volume named `my-vol`:

- For `main-container` (nginx), it's mounted at: `/usr/share/nginx/html`
- For `neighbor-container` (busybox), it's mounted at: `/var/log`

ðŸ‘‰ That means `/usr/share/nginx/html` in nginx is the same directory as `/var/log` in busybox.

#### neighbor-container writes logs

```bash
while true; do
  date >> /var/log/index.html
  echo "Hi I am from neighbor container" >> /var/log/index.html
  sleep 5
done
```

This appends date + greeting to `/var/log/index.html`.

But `/var/log` here is the shared emptyDir.

#### main-container sees the same file

Because nginx mounts the same volume at `/usr/share/nginx/html`, that file (`index.html`) also appears there.

So when you `kubectl exec ... -c main-container -- cat /usr/share/nginx/html/index.html`, you're just reading the file that `neighbor-container` has been writing.

### ðŸ”¹ Simple mental model

```
(emptyDir volume: my-vol)
     â†™                          â†˜
/usr/share/nginx/html     /var/log
(main-container)          (neighbor-container)
```

Both paths point to the same underlying storage.

```
Node filesystem (hostPath for the Pod only)
/var/lib/kubelet/pods/[podUID]/volumes/kubernetes.io~empty-dir/my-vol
        â†‘                           â†‘
        â”‚                           â”‚
 /usr/share/nginx/html        /var/log
 (main-container)             (neighbor-container)
```
