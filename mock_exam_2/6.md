# Mock Exam 2 - Question 6

## Question 6: Deployment with Rolling Update Strategy

Create a new deployment called `ocean-apd` in the default namespace using the image `kodekloud/webapp-color:v1`.

Use the following specs for the deployment:

1. Replica count should be 2
2. Set the Max Unavailable to 45% and Max Surge to 55%
3. Create the deployment and ensure all the pods are ready
4. After successful deployment, upgrade the deployment image to `kodekloud/webapp-color:v2` and inspect the deployment rollout status
5. Check the rolling history of the deployment and on the student-node, save the current revision count number to the `/opt/ocean-revision-count.txt` file
6. Finally, perform a rollback and revert the deployment image to the older version

### Solution:

#### Step 1: Create Deployment YAML

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ocean-apd
  namespace: default
spec:
  replicas: 2
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: "45%"   # ðŸ‘ˆ 45% of replicas can be unavailable during update
      maxSurge: "55%"         # ðŸ‘ˆ 55% extra pods can be created during update
  selector:
    matchLabels:
      app: ocean-apd
  template:
    metadata:
      labels:
        app: ocean-apd
    spec:
      containers:
      - name: webapp
        image: kodekloud/webapp-color:v1
```

#### Step 2: Upgrade the Deployment

```bash
root@student-node ~ âžœ  k edit deployments ocean-apd 
deployment.apps/ocean-apd edited
```

#### Step 3: Check Rollout Status

```bash
root@student-node ~ âžœ  kubectl rollout status deployment/ocean-apd 
deployment "ocean-apd" successfully rolled out
```

#### Step 4: Check Rollout History

```bash
root@student-node ~ âžœ  kubectl rollout history deployment/ocean-apd 
deployment.apps/ocean-apd 
REVISION  CHANGE-CAUSE
1         <none>
2         <none>

kubectl rollout history deployment/ocean-apd --revision=1
```

